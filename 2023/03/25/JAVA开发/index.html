<!DOCTYPE html>
 <html lang="en">
<script type="text/javascript" src="/js/love.js"></script>
<head>
  <meta charset="utf-8">
  
  <title>Hexo</title>
  <meta name="author" content="John Doe">

  
  <meta name="description" content="JAVA开发流程

初始化模型（规则树）
将规则添加到前缀树中
提取前缀树中规则
模型更新
验证

根据端口名获取端口（不存在直接添加）
123456Port p = device.getPort(&amp;quot;default&amp;quot;);public Port getPort(String nam">
  

  
  
<link rel="stylesheet" href="/css/style.css">

  
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  <!--[if lt IE 9]><script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script><![endif]-->
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <header id="header" class="inner"><nav>
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
</nav></header>
  <div id="content" class="inner"><article class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <header>
    
  
    <h1 class="p-name title" itemprop="headline name"></h1>
  

    <time class="dt-published" datetime="2023-03-25T07:42:03.248Z">
  <span class="day">25</span><span class="month">Mar</span>
</time>
  </header>
  <div class="e-content entry-content">
    
      <h3 id="JAVA开发"><a href="#JAVA开发" class="headerlink" title="JAVA开发"></a>JAVA开发</h3><p>流程</p>
<blockquote>
<p>初始化模型（规则树）</p>
<p>将规则添加到前缀树中</p>
<p>提取前缀树中规则</p>
<p>模型更新</p>
<p>验证</p>
</blockquote>
<p>根据端口名获取端口（不存在直接添加）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Port</span> <span class="variable">p</span> <span class="operator">=</span> device.getPort(<span class="string">&quot;default&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Port <span class="title function_">getPort</span><span class="params">(String name)</span> &#123;</span><br><span class="line">    nameToPort.putIfAbsent(name, <span class="keyword">new</span> <span class="title class_">Port</span>(name, <span class="built_in">this</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.nameToPort.get(name);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>规则插入树结构</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> IndexedRules <span class="title function_">traverseSrc</span><span class="params">(Rule rule, ArrayList&lt;Rule&gt; ret, <span class="type">int</span> size)</span> &#123;</span><br><span class="line">        <span class="type">IndexedRules</span> <span class="variable">t</span> <span class="operator">=</span> <span class="built_in">this</span>;</span><br><span class="line">        <span class="keyword">if</span> (ret != <span class="literal">null</span>) t.read(rule, ret, size);</span><br><span class="line">        <span class="type">long</span> <span class="variable">srcIp</span> <span class="operator">=</span> rule.getSrc();<span class="comment">//获取IP</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; rule.getSrcSuffix(); i++) &#123;<span class="comment">//遍历前缀</span></span><br><span class="line">            <span class="type">long</span> <span class="variable">bit</span> <span class="operator">=</span> (srcIp &gt;&gt; i) &amp; <span class="number">1</span>;右移i位 并将其结果与<span class="number">1</span>进行and运算</span><br><span class="line">            t = t.buildNext(bit == <span class="number">0</span> ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (ret != <span class="literal">null</span>) t.read(rule, ret, size);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ret != <span class="literal">null</span>) t.exploreSrc(rule, ret, size);</span><br><span class="line">        <span class="keyword">return</span> t.traverse(rule, size);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//read() method</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">read</span><span class="params">(Rule rule, ArrayList&lt;Rule&gt; ret, <span class="type">int</span> size)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.dst == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="type">IndexedRules</span> <span class="variable">t</span> <span class="operator">=</span> <span class="built_in">this</span>.dst;</span><br><span class="line">        <span class="keyword">if</span> (ret != <span class="literal">null</span>) ret.addAll(t.getRules());</span><br><span class="line">        <span class="type">long</span> <span class="variable">dstIp</span> <span class="operator">=</span> rule.getMatch().longValue();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; rule.getPrefix() - (<span class="number">32</span> - size); i++) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">bit</span> <span class="operator">=</span> (dstIp &gt;&gt; (size - <span class="number">1</span> - i)) &amp; <span class="number">1</span>;</span><br><span class="line">            t = (bit == <span class="number">0</span>) ? t.left : t.right;</span><br><span class="line">            <span class="keyword">if</span> (t == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">            <span class="keyword">if</span> (ret != <span class="literal">null</span>) ret.addAll(t.getRules());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ret != <span class="literal">null</span>) t.explore(ret);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//buildNext() method</span></span><br><span class="line">    <span class="keyword">private</span> IndexedRules <span class="title function_">buildNext</span><span class="params">(<span class="type">int</span> flag)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (flag == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.left == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="built_in">this</span>.left = <span class="keyword">new</span> <span class="title class_">IndexedRules</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.left;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.right == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="built_in">this</span>.right = <span class="keyword">new</span> <span class="title class_">IndexedRules</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.right;    </span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//explore() method</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">explore</span><span class="params">(ArrayList&lt;Rule&gt; ret)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.left != <span class="literal">null</span>) <span class="built_in">this</span>.left.explore(ret);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.right != <span class="literal">null</span>) <span class="built_in">this</span>.right.explore(ret);</span><br><span class="line">        ret.addAll(<span class="built_in">this</span>.getRules());</span><br><span class="line"> &#125;</span><br><span class="line"><span class="comment">//traverse() method</span></span><br><span class="line">    <span class="keyword">public</span> IndexedRules <span class="title function_">traverse</span><span class="params">(Rule rule, <span class="type">int</span> size)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.dst == <span class="literal">null</span>) <span class="built_in">this</span>.dst = <span class="keyword">new</span> <span class="title class_">IndexedRules</span>();</span><br><span class="line">        <span class="type">IndexedRules</span> <span class="variable">t</span> <span class="operator">=</span> <span class="built_in">this</span>.dst;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">dstIp</span> <span class="operator">=</span> rule.getMatch().longValue();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; rule.getPrefix() - (<span class="number">32</span> - size); i++) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">bit</span> <span class="operator">=</span> (dstIp &gt;&gt; (size - <span class="number">1</span> - i)) &amp; <span class="number">1</span>;</span><br><span class="line">            t = t.buildNext(bit == <span class="number">0</span> ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//exploreSrc() method</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">exploreSrc</span><span class="params">(Rule rule, ArrayList&lt;Rule&gt; ret, <span class="type">int</span> size)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.left != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.left.read(rule, ret, size);</span><br><span class="line">            <span class="built_in">this</span>.left.exploreSrc(rule, ret, size);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.right != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.right.read(rule, ret, size);</span><br><span class="line">            <span class="built_in">this</span>.right.exploreSrc(rule, ret, size);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">test</span></span><br><span class="line"><span class="comment">default rule 0/0 32 -&gt;srcIp=0 getSrcSuffix=0 size=32</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>模拟测试</p>
<p>假设存在三条转发规则</p>
<p>rule 1 192.168.1.1&#x2F;24  port1<br>rule 2 192.168.1.2&#x2F;16  port2<br>rule 3 192.168.1.1&#x2F;25  port3</p>
<p>存在默认规则</p>
<p>rule default 0.0&#x2F;24 default</p>
<p>过程</p>
<p>1.添加默认规则</p>
<p>调用traverseSrc(default, null, 32)</p>
<blockquote>
<p>调用traverse(default,32)</p>
</blockquote>
<p>t &#x3D; t.dst</p>
<p>2.添加规则rule 1 rule 2 rule 3</p>
<p>for循环遍历规则集合[rule 1,rule 2,rule 3]</p>
<p>添加规则rule 1</p>
<blockquote>
<p>调用traverseSrc(default, null, 32)</p>
<blockquote>
<p>执行</p>
</blockquote>
</blockquote>
</blockquote>

    
    
    <footer class="meta">
      
      
      
    </footer>
    
      
  <div class="sharing addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script src="http://s7.addthis.com/js/300/addthis_widget.js"></script>

    
    
  </div>
  
</article>
</div>
  <footer id="footer" class="inner"><div class="social alignright">
  
  
  
  <a class="rss" href="/atom.xml" title="RSS">RSS</a>
</div>
<p>
  
  &copy; 2023 John Doe
  
</p>
<div class="clearfix"></div></footer>
  
<script src="/js/jquery-3.4.1.min.js"></script>


<script src="/js/jquery.imagesloaded.min.js"></script>


<script src="/js/gallery.js"></script>






<script src="/fancybox/jquery.fancybox.min.js"></script>

<script>
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<div id="phasebeam">
  <canvas></canvas>
  <canvas></canvas>
  <canvas></canvas>
</div>

<script src="/js/phasebeam.js"></script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7}});</script></body>
</html>